var TipJar=function(){var a=TipCommunicator;a.setData(Cam4User.performerName,Cam4User.userName,Cam4User.kN,Cam4User.iB,(Cam4User.lang||lang));var b=0;this.sendTip=function(){if(Cam4User.isLoggedIn&&b>0){if(+document.getElementById("tipJarInput").value){if(+document.getElementById("tipJarInput").value<=b){a.sendOfflineTip(parseInt(document.getElementById("tipJarInput").value),document.getElementById("tipJarTextarea").value,"tipjar.tipSent");}else{TipFactory.popTokens();}}}else{if(Cam4User.isLoggedIn&&b<=0){TipFactory.popTokens();}else{if(Cam4User.contextualGender!=""){var c="/gold?ct=pptj&contextual=tokens-"+Cam4User.contextualGender;if(useResponsiveLayout){c+="&registrationType=modal";activateRegModal(c);}else{window.location=c;}}else{TipFactory.popTokens();}}}};this.freeze=function(c){document.getElementById("tipjarError").style.display="block";if(Cam4User.useResponsiveLayout){document.getElementById("tipjarAction").style.display="none";}else{document.getElementById("tipjarAction").style.visibility="hidden";}if(c){document.getElementById("tipJarMessage").innerHTML=c;}if(useResponsiveLayout){document.getElementById("tipJarTextarea").value="";document.getElementById("tipJarInput").value="";}else{document.getElementById("tipJarTextarea").value=nstiplang.includeMessage;document.getElementById("tipJarInput").value=nstiplang.enterTipAmount;}};this.revert=function(){document.getElementById("tipjarError").style.display="none";if(Cam4User.useResponsiveLayout){document.getElementById("tipjarAction").style.display="block";}else{document.getElementById("tipjarAction").style.visibility="visible";}};this.update=function(c){Cam4Logs.print("update tipjar balance:"+c);b=c;if(c==0&&Cam4User.isLoggedIn){document.getElementById("tipJarInput").style.display="none";document.getElementById("tipJarInputContainer").style.display="none";document.getElementById("tipjarHref").innerHTML=nstiplang.buyTokens;}else{document.getElementById("tipJarInput").style.display="block";document.getElementById("tipJarInputContainer").style.display="block";document.getElementById("tipjarHref").innerHTML=nstiplang.sendTip;}};this.tipSent=function(c){console.log(c);if(c.status==-1){this.freeze(nstiplang.errors.tokensNeeded);}else{if(c.status==-2){if(Cam4User.contextualGender){window.location="/gold?ct=pptj&contextual=tokens-"+Cam4User.contextualGender;}else{TipFactory.popTokens();}this.freeze(nstiplang.errors.tokensNeeded);}else{if(c.status>=0){if(useResponsiveLayout){document.getElementById("tippingSuccessDiv").className="alert alert-success";}this.freeze(nstiplang.thanksForTip);}}}try{if(TipBalance&&c.userbalance){TipBalance.updateBalanceFields(c.userbalance);}}catch(d){}this.update(c.userbalance);};this.inputFocused=function(c,d){var f=(c.id||d.target.id);switch(f){case"tipJarTextarea":var e=document.getElementById("tipJarTextarea").value;if(e.trim()===nstiplang.includeMessage.trim()){document.getElementById("tipJarTextarea").value="";}break;case"tipJarInput":var e=document.getElementById("tipJarInput").value;if(e.trim()===nstiplang.enterTipAmount.trim()){document.getElementById("tipJarInput").value="";}break;}};this.inputRestrictToNumbers=function(d,g,f){var e=g.type||f;var c=(g.which)?g.which:g.keyCode;if(c===8||c===13||c===99||c===118||c===46||c===37||c===39){return true;}if(c>31&&(c<48||c>57)){return false;}if(e==="keyup"){d.value=d.value.replace(/\D/g,"");}return true;};this.inputBlured=function(c,d){var e=(c.id||d.target.id);switch(e){case"tipJarTextarea":if(document.getElementById("tipJarTextarea").value===""){document.getElementById("tipJarTextarea").value=nstiplang.includeMessage;}break;case"tipJarInput":if(document.getElementById("tipJarInput").value===""){document.getElementById("tipJarInput").value=nstiplang.enterTipAmount;}break;}};};var tipjar=new TipJar();