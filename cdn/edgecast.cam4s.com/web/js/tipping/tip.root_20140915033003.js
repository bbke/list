function TipRoot(){this.lang={setTimeLimit:"Set Time Limit:",enterGoal:"Enter Goal:",enterTipAmmount:"Enter tip amount: ",sendTip:"Send tip",balance:"Balance: ",buyTokens:"Buy tokens",total:"Total: ",goal:"Goal: ",tickets:"Tickets: ",tipLeader:"Tip leader: ",yourTips:"Your tips: ",tokens:" Tokens",timeLeft:"Time left: ",costPerTicket:"Cost of Ticket ",showLength:"Show Length ",minutes:"Minutes",ticketGoal:"Ticket Goal: ",tokenGoal:"Token Goal: ",timeLimit:"Time Limit: ",broadcasterInGroupShow:'<p id="LoginMessage">The current performer is in a group show. You must <a href="/login" class="login">Login</a> or <a href="/gold" class="registerModal">Register</a> to start using this feature.</p>',broadcasterInPrivateShow:'<p id="LoginMessage">The current performer is in a private show. You must <a href="/login" class="login">Login</a> or <a href="/gold" class="registerModal">Register</a> to start using this feature.</p>',broadcasterBasic:'<p id="LoginMessage">You must <a href="/login" class="login">Login</a> or <a href= "/gold" class="registerModal">Register</a> to start using this feature.</p>'};this.settings={maxGoalBarWidth:246,offlineRedirectUrl:"/paygate"};this.get=function(h){return new HTMLItem(document.getElementById(h));};this.merge=function(h,j){for(var k in h){j[k]=h[k];}return j;};this.setViewerStatusMessage=function(h){$j("viewerScreenTxt").css("font-size","20px");$j("#viewerScreenTxt").text(""+h);this.arrangeStatusMessage();return h;};this.responsiveFix=function(k){if(k==="viewer"){var j=$j("#newTipAreaMain").width();var i=$j("#leftContentViewer").width();var h=$j("#rightContent").width();var l=(100-(100/(j/(i+h))))-2;$j("#middleScreen").css("width",l+"%");}};this.arrangeStatusMessage=function(){var m=$j("#viewerScreenTxt");var k=$j("#viewerScreen");var i=m.css("font-size");i=parseFloat(i.replace("px",""));var h=m.height();var l=k.height();if($j("#lastUpdateVal").is(":visible")){l=l-16;}if(Cam4User.useResponsiveLayout){m.width("100%");}else{m.width("335px");}m.css("word-break","break-all");if(h>l){var j=(i-1);m.css("font-size",j+"px");this.arrangeStatusMessage();}else{m.css("top",((l-h)/2)+"px");}};this.setViewerOnline=function(){$j("#leftContentViewer").show();$j("#broadcasterScreen").hide();$j("#leftContentBroadcast").hide();$j("#broadcasterScreen").hide();$j("#viewerScreen").show();$j("#goalMeterBox").show();$j("#viewerOffline").hide();$j("#viewerOnline").show();$j("#info1").show();$j("#info2").show();return true;};this.confirmViewerStatusMessage=function(h){this.setViewerStatusMessage(h);this.colorTransitionEffect({r:156,g:156,b:156},{r:255,g:255,b:255},this.get("viewerScreen").domElement);};this.confirmUpRedLabel=function(h){this.get("i_tipGoal").domElement.value=(h+"");this.colorTransitionEffect({r:114,g:86,b:86},{r:251,g:228,b:216},this.get("i_tipGoal").domElement);};this.confirmDownRedLabel=function(h){this.get("i_timeLimit").domElement.value=(h+"");this.colorTransitionEffect({r:114,g:86,b:86},{r:251,g:228,b:216},this.get("i_timeLimit").domElement);};this.confirmFirstInfo=function(h){$j("#infoNum1").text(""+h);this.textColorEffect({r:238,g:238,b:238},{r:56,g:56,b:56},this.get("info1").domElement);};this.confirmSecondInfo=function(h){$j("#infoNum2").text(""+h);this.textColorEffect({r:238,g:238,b:238},{r:56,g:56,b:56},this.get("info2").domElement);};this.colorTransitionEffect=function(k,i,j){var h=new TweenMulti(k,i,60);h.onUpdate=function(l){j.style.backgroundColor=ColorUtils.rgbToHex(l.r,l.g,l.b);};h.start();};this.textColorEffect=function(k,i,j){var h=new TweenMulti(k,i,60);h.onUpdate=function(l){j.style.color=ColorUtils.rgbToHex(l.r,l.g,l.b);};h.start();};this.setBroadcasterOnline=function(){$j("#leftContentViewer").hide();$j("#leftContentBroadcast").show();$j("#broadcasterScreen").show();$j("#viewerScreen").hide();$j("#goalMeterBox").show();$j("#viewerOffline").hide();$j("#viewerOnline").hide();$j("#viewerOffline").hide();$j("#leftContentBroadcast").show();$j("#broadcasterScreen").show();$j("#lastUpdateVal").css("bottom","4px");this.toogleGoalBar(false);$j("#infoPre2").html(nstiplang.yourEarnings+":");$j("#infoNum2").html("0");$j("#infoSu2").html(nstiplang.tokens);$j("#infoPre1").html(nstiplang.tipLeader);$j("#infoNum1").html(" (0"+nstiplang.tokens+")");$j("#infoSu1").html("");this.setInputIndexes();return true;};this.setInputIndexes=function(){$j("#i_tipGoal").attr("tabindex","1");$j("#i_timeLimit").attr("tabindex","2");$j("#i_screen").attr("tabindex","3");return true;};this.fitOfflineText=function(i){if($j("#viewerOffline").is(":visible")){var j=$j("#viewerOffline").height();var h=this;if(j<74){$j("#viewerOffline").css("font-size",i+"px");$j("#viewerOffline").css("line-height",i+"px");setTimeout(function(){h.fitOfflineText(i+0.1);},10);}else{$j("#viewerOffline").css("font-size",i+"px");$j("#viewerOffline").css("line-height",i+"px");}}};this.setViewerOffline=function(j){this.loadLang();var i=this.lang.broadcasterBasic;if(j){switch(j){case"inGS":i=this.lang.broadcasterInGroupShow;break;case"inPS":i=this.lang.broadcasterInPrivateShow;break;default:i=this.lang.broadcasterBasic;break;}}$j("#viewerOffline").css("font-size","15px");$j("#viewerOffline").css("padding-top","4px");$j("#viewerOnline").hide();$j("#broadcasterScreen").hide();$j("#leftContentBroadcast").hide();$j("#viewerOffline").show();$j("#viewerOffline").html(i);var h=this;this.buttonClicked=function(k){window.location.href=h.settings.offlineRedirectUrl;};$j("#viewerOnline").hide();this.toogleBlackBar(false);if($j("#viewerOffline").html()){if($j("#viewerOffline").html().length>160){$j("#viewerOffline").css("font-size","11px");$j("#viewerOffline").css("padding-top","0px");}else{if($j("#viewerOffline").html().length>82&&j){$j("#viewerOffline").css("font-size","13px");$j("#viewerOffline").css("padding-top","0px");}else{$j("#viewerOffline").css("font-size","15px");$j("#viewerOffline").css("padding-top","4px");}}}if(BrowserDetect.browser==="Explorer"&&BrowserDetect.version<10){$j("#sendTipButtonViewer").css("filter","none");$j("#sendTipButtonViewer").css("color","black");}return true;};this.setRightContentData=function(j,i,h,m,l,k,p,o,n){$j("#infoPre1").html(j);$j("#infoPre2").html(i);$j("#infoPre3").html(h);$j("#infoNum1").html(m);$j("#infoNum2").html(l);$j("#infoNum3").html(k);$j("#infoSu1").html(p);$j("#infoSu2").html(" "+o);$j("#infoSu3").html(n);return true;};this.updateRightContentData=function(j,i,h){$j("#infoNum1").text(j);$j("#infoNum2").text(i);$j("#infoNum3").text(h);};this.setGoalBarData=function(k,j,i,h){$j("#gPre1").text(k);$j("#gPre2").text(j);$j("#gPre1White").text(k);$j("#gPre2White").text(j);$j("#gNum1").text(i);$j("#gNum2").text(h);$j("#gNum1White").text(i);$j("#gNum2White").text(h);};this.updateGoalBarData=function(l,j){var i=parseInt(l);var h=parseInt(j);if(isNaN(i)||typeof l=="undefined"){i=0;}if(isNaN(h)||typeof j=="undefined"){h=0;}$j("#gNum1").html(""+i);$j("#gNum2").html(""+h);$j("#gNum1White").html(""+i);$j("#gNum2White").html(""+h);if(l===j){$j("#goalBack").width(this.settings.maxGoalBarWidth+"px");$j("#whiteBoxWrapper").width(this.settings.maxGoalBarWidth+"px");$j("#gPre1").css("color","white");$j("#gNum1").css("color","white");$j("#gPre2").css("color","white");$j("#gNum2").css("color","white");return;}else{if(i===0){$j("#goalBack").width("0px");$j("#whiteBoxWrapper").width("0px");$j("#gPre1").css("color","black");$j("#gNum1").css("color","black");$j("#gPre2").css("color","black");$j("#gNum2").css("color","black");return;}else{$j("#gPre1").css("color","black");$j("#gNum1").css("color","black");$j("#gPre2").css("color","black");$j("#gNum2").css("color","black");}}var k;if(i<h){k=(this.settings.maxGoalBarWidth*e(i))/e(h);$j("#goalBack").width(k+"px");$j("#whiteBoxWrapper").width(k+"px");$j("#gNum2").css("color","black");}else{k=this.settings.maxGoalBarWidth;$j("#goalBack").width(this.settings.maxGoalBarWidth+"px");$j("#whiteBoxWrapper").width(this.settings.maxGoalBarWidth+"px");$j("#gNum2").css("color","white");}return k;};this.toogleGoalBar=function(h){if(h){$j("#goalMeterBox").show();}else{$j("#goalMeterBox").hide();}};this.setBlackBarMessage=function(h){$j("#info3").html(h);};this.toogleBlackBar=function(h){if(h){$j("#info1").css("margin-top","0px");$j("#info3").show();}else{$j("#info1").css("margin-top","10px");$j("#info3").hide();}};this.addStickyMessage=function(i,j){Cam4Logs.print("addSticky message in tip.root.js : "+i);var h=document.createElement("div");h.setAttribute("class","dmsg");h.innerHTML=i+"";this.get("bottomStatusBar").domElement.appendChild(h);$j(h).fadeOut(2500,function(){document.getElementById("bottomStatusBar").removeChild(h);if(j){j();}});};this.inputsData={tipGoal:-1,timeLimit:-1,statusMessage:"",tipAmmount:-1};var c=20;this.alignInputScreen=function(j,l){var m=$j(j);var h=m.val();var k=h.length;var i={min:27,med:52,max:64};if(h===h.toLowerCase()){i.min=33;i.med=81;i.max=90;}if(k<i.min){m.css("font-size",c+"px");m.css("line-height","50px");}if(k>=i.min&&k<=i.med){m.css("font-size",c+"px");m.css("line-height","normal");}if(k>i.med&&k<=i.max){m.css("font-size","16px");m.css("line-height","25px");}if(k>i.max){m.css("font-size","16px");m.css("line-height","normal");}};this.inputRestrictToNumbers=function(i,j){var h=(j.which)?j.which:j.keyCode;if(h===13){this.buttonClicked({id:"sendTipButtonViewer"});this.inputFocusedIn(i,j);return false;}else{if(h!==46&&h>31&&(h<48||h>57)&&(h<96||h>105)){return false;}}return true;};this.inputFocusedIn=function(h){if(h.id!="i_screen"){h.value="";}};this.inputFocusedOut=function(i){var h=i.value;switch(i.id){case"i_tipGoal":if(g(h)){this.inputsData.tipGoal=parseInt(h);this.onGoalUpdate(this.inputsData);}break;case"i_tipAmmo":if(+h){this.inputsData.tipAmmount=parseInt(h);this.onAmmoUpdate(this.inputsData);}break;case"i_timeLimit":if(g(h)){this.inputsData.timeLimit=parseInt(h);this.onTimeLimitUpdate(this.inputsData);}break;case"i_screen":if(a(h)){this.inputsData.statusMessage=h;this.onBroadcasterStatusUpdate(this.inputsData);}break;}this.refreshInputs();};this.refreshInputs=function(){this.get("i_tipGoal").domElement.value=(this.inputsData.tipGoal>0?this.inputsData.tipGoal:0);this.get("i_tipAmmo").domElement.value=(this.inputsData.tipAmmount>0?this.inputsData.tipAmmount:0);this.get("i_timeLimit").domElement.value=(this.inputsData.timeLimit>0?this.inputsData.timeLimit:0);this.get("i_screen").domElement.value=(this.inputsData.statusMessage);this.inputDataChanged(this.inputsData);};this.buttonClicked=function(h){if(h.id==="sendTipButtonViewer"){if(g(this.get("i_tipAmmo").domElement.value)){console.log("send tip clicked");this.onSendTipClicked(parseInt(this.get("i_tipAmmo").domElement.value));}}if(h.id==="buyTokensButtonViewer"){window.open("/checkout/tokens","","width=700,height=700,scrollbars=1,toolbars=0,status=0,resizable=1");}return false;};this.onGoalUpdate=function(h){b("goal changed");b(h);};this.onAmmoUpdate=function(h){b("ammo changed");b(h);};this.onTimeLimitUpdate=function(h){b("time left changed");b(h);};this.onBroadcasterStatusUpdate=function(h){b("br status changed");b(h);};this.onSendTipClicked=function(h){b("send tip function called");b(h);};this.updateData=function(h){this.outPutsData=this.merge(h,this.outPutsData);this.get("balanceVal").text(this.outPutsData.tokenBalance);this.updateGoalBarData(this.outPutsData.viewerTotal,this.outPutsData.viewerGoal);this.updateRightContentData(this.outPutsData.riA,this.outPutsData.riB,this.outPutsData.riC);this.setViewerStatusMessage(this.outPutsData.viewerStatus);};this.outPutsData={tokenBalance:0,viewerStatus:" ",viewerGoal:0,viewerTotal:0,lastUpdated:20,riA:0,riB:0,riC:0};this.inputDataChanged=function(h){b("input data changed");b(h);};this.loadLang=function(){try{this.lang=nstiplang;}catch(h){}$j("#infoPre1").text(this.lang.tipLeader);$j("#infoPre2").text(this.lang.yourTips);$j("#gPre1").text(this.lang.total);$j("#gPre2").text(this.lang.goal);$j("#gPre1White").text(this.lang.total);$j("#gPre2White").text(this.lang.goal);$j("#gwPre1").text(this.lang.total);$j("#gwPre2").text(this.lang.goal);$j("#i_tipAmmo").val(this.lang.enterTipAmmount);$j("#sendTipButtonViewer").text(this.lang.sendTip);$j("#balanceTxt").text(this.lang.balance);$j("#buyTokensButtonViewer").text(this.lang.buyTokens);$j("#lastUpdateVal").text(" ");$j("#brUpInputDesc").text(this.lang.tokens);$j("#brDownInputDesc").text(this.lang.minutes);$j("#brUpRedLabel").text(this.lang.enterGoal);$j("#brDownRedLabel").text(this.lang.setTimeLimit);this.fixLang();return true;};this.disableSendTipInput=function(){this.get("i_tipAmmo").domElement.setAttribute("disabled","true");this.get("sendTipButtonViewer").domElement.setAttribute("disabled","true");this.get("i_tipAmmo").domElement.opacity="0.5";$j("#sendTipButtonViewer").addClass("sendTipButtonBlocked");};this.enableSendTipInput=function(){this.get("i_tipAmmo").domElement.removeAttribute("disabled");this.get("sendTipButtonViewer").domElement.removeAttribute("disabled");this.get("i_tipAmmo").domElement.opacity="1";$j("#sendTipButtonViewer").removeClass("sendTipButtonBlocked");this.get("i_tipAmmo").domElement.value=this.lang.enterTipAmmount;};var f=["sendTipBox","viewerScreen",];this.freeze=function(h){if(Cam4User.isLoggedIn){$j("#tipErrorMessage").remove();$j("#leftContentBroadcast").hide();$j("#sendTipBox").hide();$j("#middleScreen").hide();$j("#rightContent").hide();$j("#newTipAreaBox").append('<div id="tipErrorMessage">'+h+"</div>");}return true;};this.unFreeze=function(){$j("#tipErrorMessage").remove();$j("#sendTipBox").show();$j("#middleScreen").show();$j("#rightContent").show();if(Cam4User.isBroadcaster()){$j("#leftContentBroadcast").show();}return false;};this.fixLang=function(){this.lang=nstiplang;try{if($j("#brUpRedLabel").html().length>12){$j("#brUpRedLabel").css("font-size","8px");}if($j("#brDownRedLabel").html().length>13){$j("#brDownRedLabel").css("font-size","9px");}if($j("#brDownRedLabel").html().length>23&&Cam4User.lang==="ro"){$j("#brDownRedLabel").css("font-size","9px");$j("#brDownRedLabel").css("word-break","break-all");$j("#brDownRedLabel").css("white-space","normal");}if($j("#sendTipButtonViewer").html().length>11){$j("#sendTipButtonViewer").css("font-size","9px");}if(Cam4User.lang==="pt"){if(Cam4User.isBroadcaster()){$j("#brDownRedLabel").css("font-size","8px");$j("#brDownRedLabel").css("white-space","normal");$j("#brUpRedLabel").css("white-space","normal");}else{$j("#brUpRedLabel").css("font-size","7px");}}if(Cam4User.lang==="it"){$j("#i_tipAmmo").css("font-size","11px");}if(Cam4User.lang==="fr"&&Cam4User.isViewer()){$j("#infoBox").css("width","260px");}if(Cam4User.lang==="fr"&&Cam4User.isBroadcaster()){$j("#brDownRedLabel").css("font-size","10px");$j("#brDownRedLabel").css("white-space","normal");}if(Cam4User.lang==="es"&&Cam4User.isBroadcaster()){$j("#brDownRedLabel").css("font-size","9px");$j("#brDownRedLabel").css("white-space","normal");$j("#brUpRedLabel").css("white-space","normal");}if(Cam4User.lang==="de"&&Cam4User.isViewer()){$j("#info1").css("line-height","9px");$j("#rightContent").css("margin-top","2px");}}catch(h){console.log("fix lang failed");}};this.init=function(){var h=this;try{this.loadLang();if(Cam4User.isBroadcaster()){this.setBroadcasterOnline();}else{this.setViewerOffline();}b("tipping lang loaded");}catch(i){b("init failed");b(i);}};this.close=function(){};this.getStatus=function(){};function b(h){}function a(i){var h=i;h=h.replace(/\s/g,"");if(h===""){return false;}return true;}function g(h){if(a(h)){if(isNaN(h)===false){if(parseInt(h)>0){return true;}}}return false;}function e(h){return h<=0?0.1:h;}function d(h){var i=parseInt(h).toString(16);return i.length===1?"0"+i:i;}this.testGoalBar=function(h,m){$j("#goalMeterBox").show();var i=100;var j=100;if(h){i=h;}if(m){j=h;}var l=0;function k(){if(l<=i){$j("#goalMeterBox").show();ncTip.updateGoalBarData(l,i);l++;setTimeout(k,100);}}k();};}var ncTip=new TipRoot();ncTip.init();$j(document).ready(function(){ncTip.loadLang();});function switchb(){$j("#tippingDiv").hide();$j("#newTipAreaMain").show();tipping.kill();}