function ajCommentFailure(a){$j("#commentPrompt").text("Ajax error");}function addComment(d){var a=Math.floor(Math.random()*99999999999);var c=$j("#message-wall").val();if(c!=""){var b={data:{t:a,action:"post",message:c},type:"POST",url:"/_profile/wall?username="+d,success:function(){destroyMessageInCookie();$j("#commentForm")[0].reset();reloadComments(d);},error:function(){},complete:function(e){var f=jQuery.parseJSON(e.responseText);$j("#commentPrompt").text("");if(f.code=="OK"||f.code=="tooLong"){$j("#commentForm").show();}$j(".deletelink").show();}};$j(".deletelink").hide();$j("#commentForm").hide();$j.ajax(b);}}function removeComment(c,b,f,e){var a=Math.floor(Math.random()*99999999999);var d={data:{t:a,action:"delete",commentId:c,firebaseId:b},type:"POST",url:"/_profile/wall?username="+e,success:function(){reloadComments(e);},error:function(){},complete:function(g){$j("#commentPrompt").html(g.responseText);var h=jQuery.parseJSON(g.responseText);$j("#commentPrompt").text("");if(h.code=="tryLater"){return;}if(g.responseText==""){$j("#commentForm").show();}$j(".deletelink").show();}};$j(".deletelink").hide();$j("#commentForm").hide();$j.ajax(d);}function reloadComments(c){var a=Math.floor(Math.random()*99999999999);var b={t:a};$j("#commentsPageWrapper").load("/_profile/asyncComment?username="+c,$j.param(b),function(d,f,e){});}function trimComment(a){if(a.value.length<=250){return;}a.value=a.value.substring(0,250);}function showMessageButton(){document.getElementById("t3").style.display="inline-block";}function destroyMessageInCookie(){Cam4Cookies.deleteCookie("chatWallMessage");}function saveMessageInCookie(a){Cam4Cookies.setCookie("chatWallMessage",a,60*60*1000);}function readMessageFromCookie(){var a=Cam4Cookies.getCookie("chatWallMessage");if(a==null){a="";}return a;}function textToggle(){if(document.getElementById("t1").style.display=="none"&&document.getElementById("message-wall").value==""){document.getElementById("t1").style.display="block";document.getElementById("message-wall").style.display="none";document.getElementById("t3").style.display="none";}else{document.getElementById("t1").style.display="none";document.getElementById("message-wall").style.display="block";document.getElementById("t3").style.display="inline-block";if(!useResponsiveLayout){document.getElementById("message-wall").focus();}}}var msg=readMessageFromCookie();if(msg!=""){textToggle();}if(document.getElementById("message-wall")){document.getElementById("message-wall").value=msg;}function setChatWallDisplayEvents(){var a=$j("#t1"),c=$j("#t3"),b=$j("#message-wall");a.on("focus",function(){$j(this).hide();c.show();b.show().focus();});if(useResponsiveLayout){b.on("focus",function(){c.show();});}$j(window).on("click",function(d){if(d.target!=c&&b.val()==""&&d.target.id!="message-wall"){c.hide();a.show();b.hide();}});}$j(function(){setChatWallDisplayEvents();});var giftWrap=document.getElementById("giftShelfWrap");if(giftWrap==null){var colChatWall=document.getElementById("col2ChatWall");if(colChatWall!=null){colChatWall.style.width="100%";}}var chatWallContent=document.getElementById("col2ChatWall");if(chatWallContent==null){var colGift=document.getElementById("giftShelfWrap");if(colGift!=null){colGift.style.width="auto";}}if(!Cam4User.isLoggedIn&&!useResponsiveLayout){function closeLoginOverlay(){$j("#modalLayout").hide();}$j(function(){$j("#t3").on("click",function(){saveMessageInCookie(document.getElementById("message-wall").value);$j("#modalLayout").show();$j("#popUpUsername").focus();});$j(".close").on("click",function(){closeLoginOverlay();});$j(document).on("keydown",function(a){if(a.keyCode===27){closeLoginOverlay();}});});}var wallChat=(function(){function d(){message=$j("#message-wall").val();$j.post("wall",{message:message});}function c(i){var h=i.toString().split(" ");h=h[0].split("/");var f=h[2]+"-"+h[0]+"-"+h[1];var g=new Date(f).toString().split(" ");return g[1]+" "+g[2]+", "+g[3];}function b(g){var k=g.val();var j=k.message;var m=k.sender_username;var h=$j("#bulkComment .userMessage").clone();h.find(".message").text(j);h.find("#userNameLink").text(m);var l="/"+m;h.find("#userNameLink").attr({href:l});h.find("#avatarLink").attr({href:l});h.find(".timestamp").text(c(k.timestamp));var i="http://wac.9218.systemcdn.net/809218/web/avatar/user/60x60/"+m+".jpg";h.find(".prImg").attr({src:i});var f="comment"+k.comment_sqldb_id;h.attr("id",f);return h;}function e(i,g){var h=true;var f=new Firebase(cam4FirebaseHost+"userComments/byRecipient/"+i);f.auth(g);f.endAt(1).on("child_added",function(j,l){if(!h){var k=b(j);$j("#commentsDiv").prepend(k);}});f.once("value",function(j){h=false;});f.on("child_removed",function(k){var l=k.val();var j=l.comment_sqldb_id;$j("#comment"+j).remove();});}var a={init:e,sendToFirebase:d,dateConverter:c};return a;})();